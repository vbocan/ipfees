@page
@using IPFees.Core;
@using static IPFees.Core.OfficialFee;
@model ResultModel
@{
    ViewData["Title"] = "Calculation Result";
}

<h1>Calculation Results</h1>

<div class="row">
    <div class="col-lg-6">
        <div class="accordion" id="accordionResult">
            @{
                var i = 0;
            }
            @foreach (var fr in Model.FeeResults)
            {
                i++;
                @if (fr is FeeResultCalculation)
                {
                    var res = (FeeResultCalculation)fr;
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="@($"heading-{i}")">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#@($"collapse-{i}")" aria-expanded="true" aria-controls="@($"collapse-{i}")">
                                @($"[{res.FeeName}] - {res.FeeDescription} (SUCCESS)")
                            </button>
                        </h2>
                        <div id="@($"collapse-{i}")" class="accordion-collapse collapse" aria-labelledby="@($"heading-{i}")" data-bs-parent="#accordionResult">
                            <div class="accordion-body">
                                <div class="col-md-4">
                                    <h4>Total: @((res.TotalMandatoryAmount + res.TotalOptionalAmount).ToString("0.00"))</h4>
                                </div>
                                <div class="col-md-8">
                                    <h6>Mandatory Fees: @res.TotalMandatoryAmount.ToString("0.00") | Optional Fees: @res.TotalOptionalAmount.ToString("0.00")</h6>
                                </div>
                                <strong>Notes:</strong>
                                <ul>
                                    @foreach (var re in res.Returns)
                                    {
                                        <li>@($"[{re.Item1}] => [{re.Item2}]")</li>
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    var res = (FeeResultFail)fr;
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="@($"heading-{i}")">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#@($"collapse-{i}")" aria-expanded="true" aria-controls="@($"collapse-{i}")">
                                @($"[{res.FeeName}] - {res.FeeDescription} (FAILED)")
                            </button>
                        </h2>
                        <div id="@($"collapse-{i}")" class="accordion-collapse collapse" aria-labelledby="@($"heading-{i}")" data-bs-parent="#accordionResult">
                            <div class="accordion-body">
                                Calculation has failed.
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
