@page
@model ReferenceModel
@{
    ViewData["Title"] = "IPFLang Reference";
}
<h1>IPFLang</h1>
<h2>A Domain-Specific Language for Modern IP Fees Calculation</h2>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Overview</h5>
        <h6 class="card-subtitle mb-2 text-muted">
            Inputs and Fees
        </h6>
        <p class="card-text">
            The process of describing IP fees in IPFLang consists of determining what the inputs are and how the fee is composed off small amounts that accrue based on rules.<br/>
            There are five types of inputs available:
        </p>
        <ul>
            <li>String list with individual choices</li>
            <li>String list with multiple choices</li>
            <li>Number (floating point), with lower and upper bounds as well as a default value</li>
            <li>Boolean (for yes/no types of responses)</li>
            <li>Date (for selecting the number of yers/months/days to a specific date)</li>
        </ul>
        <p>
            Inputs are presented as HTML controls that the user fill in and upon form submission, the values are used to compute the fee. The system displays the full list of steps taken to reach the result, to aid debugging.
        </p>
    </div>
</div>


<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Single-Selection List</h5>
        <h6 class="card-subtitle mb-2 text-muted">Single-selection input displays a list of string choices and allows the user to select one of those. A default choice must be specified.</h6>
        <p class="card-text">
            DEFINE LIST EntityType AS 'Select the desired entity type'<br />
            CHOICE NormalEntity AS 'Normal'<br />
            CHOICE SmallEntity AS 'Small'<br />
            CHOICE MicroEntity AS 'Micro'<br />
            DEFAULT NormalEntity<br />
            ENDDEFINE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Multiple-Selection List</h5>
        <h6 class="card-subtitle mb-2 text-muted">Multiple-selection input displays a list of string choices and allows the user to select one or more of those. One or more default choices must be specified (separated by comma).</h6>
        <p class="card-text">
            DEFINE MULTILIST EntityType AS 'Select the desired entity type'<br />
            CHOICE NormalEntity AS 'Normal'<br />
            CHOICE SmallEntity AS 'Small'<br />
            CHOICE MicroEntity AS 'Micro'<br />
            DEFAULT SmallEntity,NormalEntity<br />
            ENDDEFINE
        </p>
        <p>To get the number of selected choices, use the !COUNT property, e.g. EntityType!COUNT.</p>
        <p>To test user selection, use the IN and NIN operators.</p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Number Input</h5>
        <h6 class="card-subtitle mb-2 text-muted">Number inputs allow entering a numeric value (floating point), bounded by lower and upper limits. A default value must be specified.</h6>
        <p class="card-text">
            DEFINE NUMBER SheetCount AS 'Enter the number of sheets'<br />
            BETWEEN 10 AND 1000<br />
            DEFAULT 15<br />
            ENDDEFINE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Boolean Input</h5>
        <h6 class="card-subtitle mb-2 text-muted">Boolean inputs allow selecting a condition. The default selection can be specified.</h6>
        <p class="card-text">
            DEFINE BOOLEAN ContainsDependentClaims AS 'Does this contain dependent claims?'<br />
            DEFAULT TRUE<br />
            ENDDEFINE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Date Input</h5>
        <h6 class="card-subtitle mb-2 text-muted">Date inputs allow entering a date bounded by lower and upper limits. A default date must be specified.</h6>
        <p class="card-test">
            The special value TODAY is replaced at runtime with the actual value. The date format is DD.MM.YYYY.
        </p>
        <p class="card-text">
            DEFINE DATE ApplicationDate AS 'Application date'<br/>
            BETWEEN 01.01.2023 AND TODAY<br />
            DEFAULT 01.03.2023<br />
            ENDDEFINE
        </p>
        <p>The date input cannot currently be used by itself. To get the number of years from a specific date in the past till now, use the !YEARSTONOW property, e.g. ApplicationDate!YEARSTONOW. Similarly, use the !MONTHSTONOW and !DAYSTONOW properties.</p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Fee Definition</h5>
        <h6 class="card-subtitle mb-2 text-muted">Any number of fees can be created and they all account towards the grand total. In it's simplest form, a fee yields a singe value with no condition.</h6>
        <p class="card-text">
            COMPUTE FEE SimplestFee<br />
            YIELD 150<br/>
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Optional Fees</h5>
        <h6 class="card-subtitle mb-2 text-muted">Fees can be declared as optional. Option fees still account towards the grand total, but they are marked as such in the final result.</h6>
        <p class="card-text">
            COMPUTE FEE SimplestOptionalFee OPTIONAL<br />
            YIELD 150<br/>
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Conditional Fees</h5>
        <h6 class="card-subtitle mb-2 text-muted">Conditions can be added to each YIELD branch. In this case, BasicNationalFee gets calculated according to the user selection in the EntityType input.</h6>
        <p>The following operators are currently supported: EQ, NEQ, LT, LTE, GT, GTE.</p>
        <p class="card-text">
            COMPUTE FEE BasicNationalFee<br />
            YIELD 320 IF EntityType EQ NormalEntity<br />
            YIELD 128 IF EntityType EQ SmallEntity<br />
            YIELD 64 IF EntityType EQ MicroEntity<br />
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Conditional Fees (More Complex)</h5>
        <h6 class="card-subtitle mb-2 text-muted">For more complex scenarios, the CASE clause can be used. In this particular care, certain amounts are added function of the SituationType input. YIELD statements outside the CASE are evaluated normally.</h6>
        <p class="card-text">
            COMPUTE FEE ExaminationFee<br />
            CASE SituationType EQ PreparedIPEA AS<br />
            YIELD 20 IF EntityType EQ NormalEntity<br />
            YIELD 40 IF EntityType EQ SmallEntity<br />
            YIELD 60 IF EntityType EQ MicroEntity<br />
            ENDCASE<br />
            YIELD 800 IF EntityType EQ NormalEntity<br />
            YIELD 360 IF EntityType EQ SmallEntity<br />
            YIELD 160 IF EntityType EQ MicroEntity<br />
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Complex Amounts</h5>
        <h6 class="card-subtitle mb-2 text-muted">The YIELDed amount can be computed using a complex formula. If rounding is needed, one of the usual rounding functions can be used (see below).</h6>
        <p class="card-text">
            COMPUTE FEE SheetFee<br />
            YIELD 420*((SheetCount-100)/50) IF SheetCount GT 100 AND EntityType EQ NormalEntity<br />
            YIELD 168*((SheetCount-100)/50) IF SheetCount GT 100 AND EntityType EQ SmallEntity<br />
            YIELD 84*((SheetCount-100)/50) IF SheetCount GT 100 AND EntityType EQ MicroEntity<br />
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Number Rounding Functions</h5>
        <h6 class="card-subtitle mb-2 text-muted">Rounding is accomplished using FLOOR, ROUND, CEIL functions.</h6>
        <p class="card-text">
            <ul>
                <li>FLOOR - strips off the decimal part, e.g. 4.7 -> 4</li>
                <li>ROUND - rounds to the nearest integer, e.g. 4.7 -> 5 and 4.3 -> 4</li>
                <li>CEIL - rounds to the largest integer, e.g. 4.3 -> 5</li>
            </ul>
            COMPUTE FEE SheetFee<br />
            YIELD ROUND(420*((SheetCount-100)/50)) IF SheetCount GT 100 AND EntityType EQ NormalEntity<br />
            YIELD FLOOR(168*((SheetCount-100)/50)) IF SheetCount GT 100 AND EntityType EQ SmallEntity<br />
            YIELD CEIL(84*((SheetCount-100)/50)) IF SheetCount GT 100 AND EntityType EQ MicroEntity<br />
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">List Selection Test</h5>
        <h6 class="card-subtitle mb-2 text-muted">To test for user selection, use the IN and NIN operators.</h6>
        <p class="card-text">
            COMPUTE FEE SheetFee<br />
            YIELD 100 IF Country1 IN Countries<br />
            YIELD 200 IF Country2 IN Countries<br />
            YIELD 25 IF Country1 NIN Countries AND COuntry2 NIN Countries
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Fee Local Variables</h5>
        <h6 class="card-subtitle mb-2 text-muted">Local variables can be defined inside the scope of a fee. This is to enhance readability and simplify fee computation.</h6>
        <p class="card-text">
            COMPUTE FEE SheetFee<br />
            LET A AS 20<br/>
            LET B AS 40<br/>
            YIELD A*200+B<br />
            ENDCOMPUTE
        </p>
    </div>
</div>

<div class="card mb-3" style="width: 48rem;">
    <div class="card-body">
        <h5 class="card-title">Example</h5>
        <h6 class="card-subtitle mb-2 text-muted">Use this as a starting point to your own fee computation.</h6>
        <p class="card-text">
            DEFINE LIST EntityType AS 'Select the desired entity type'<br />
            CHOICE NormalEntity AS 'Normal'<br />
            CHOICE SmallEntity AS 'Small'<br />
            CHOICE MicroEntity AS 'Micro'<br />
            DEFAULT NormalEntity<br />
            ENDDEFINE<br />
            <br />
            DEFINE LIST SituationType AS 'Situation type'<br />
            CHOICE PreparedIPEA AS 'IRRP (Chapter II) prepared by the IPEA/US'<br />
            CHOICE PaidAsISA AS 'International search fee paid as ISA'<br />
            CHOICE PreparedISA AS 'Search report prepared by an ISA other than the US'<br />
            CHOICE AllOtherSituations AS 'All other situations'<br />
            DEFAULT PreparedIPEA<br />
            ENDDEFINE<br />
            <br />
            DEFINE NUMBER SheetCount AS 'Enter the number of sheets'<br />
            BETWEEN 10 AND 1000<br />
            DEFAULT 15<br />
            ENDDEFINE<br />
            <br />
            DEFINE NUMBER ClaimCount AS 'Number of claims'<br />
            BETWEEN 0 AND 1000<br />
            DEFAULT 0<br />
            ENDDEFINE<br />
            <br />
            DEFINE BOOLEAN ContainsDependentClaims AS 'Does this contain dependent claims?'<br />
            DEFAULT TRUE<br />
            ENDDEFINE<br />
            <br />
            COMPUTE FEE BasicNationalFee<br />
            YIELD 320 IF EntityType EQ NormalEntity<br />
            YIELD 128 IF EntityType EQ SmallEntity<br />
            YIELD 64 IF EntityType EQ MicroEntity<br />
            ENDCOMPUTE<br />
            <br />
            COMPUTE FEE SearchFee<br />
            CASE SituationType EQ PreparedIPEA AS<br />
            YIELD 0 IF EntityType EQ NormalEntity<br />
            YIELD 0 IF EntityType EQ SmallEntity<br />
            YIELD 0 IF EntityType EQ MicroEntity<br />
            ENDCASE<br />
            CASE SituationType EQ PaidAsISA AS<br />
            YIELD 140 IF EntityType EQ NormalEntity<br />
            YIELD 56 IF EntityType EQ SmallEntity<br />
            YIELD 28 IF EntityType EQ MicroEntity<br />
            ENDCASE<br />
            CASE SituationType EQ PreparedISA AS<br />
            YIELD 540 IF EntityType EQ NormalEntity<br />
            YIELD 216 IF EntityType EQ SmallEntity<br />
            YIELD 108 IF EntityType EQ MicroEntity<br />
            ENDCASE<br />
            YIELD 700 IF EntityType EQ NormalEntity<br />
            YIELD 280 IF EntityType EQ SmallEntity<br />
            YIELD 140 IF EntityType EQ MicroEntity<br />
            ENDCOMPUTE<br />
            <br />
            COMPUTE FEE ExaminationFee<br />
            CASE SituationType EQ PreparedIPEA AS<br />
            YIELD 0 IF EntityType EQ NormalEntity<br />
            YIELD 0 IF EntityType EQ SmallEntity<br />
            YIELD 0 IF EntityType EQ MicroEntity<br />
            ENDCASE<br />
            YIELD 800 IF EntityType EQ NormalEntity<br />
            YIELD 360 IF EntityType EQ SmallEntity<br />
            YIELD 160 IF EntityType EQ MicroEntity<br />
            ENDCOMPUTE<br />
            <br />
            COMPUTE FEE SheetFee<br />
            LET A AS 420<br/>
            LET B AS 420<br />
            LET C AS 420<br />
            YIELD ROUND(A*((SheetCount-100)/50)) IF SheetCount GT 100 AND EntityType EQ NormalEntity<br />
            YIELD ROUND(B*((SheetCount-100)/50)) IF SheetCount GT 100 AND EntityType EQ SmallEntity<br />
            YIELD ROUND(C*((SheetCount-100)/50)) IF SheetCount GT 100 AND EntityType EQ MicroEntity<br />
            ENDCOMPUTE<br />
            <br />
            COMPUTE FEE ClaimFee<br />
            YIELD (480*ClaimCount) IF ClaimCount GT 3 AND EntityType EQ NormalEntity<br />
            YIELD (192*ClaimCount) IF ClaimCount GT 3 AND EntityType EQ SmallEntity<br />
            YIELD (96*ClaimCount) IF ClaimCount GT 3 AND EntityType EQ MicroEntity<br />
            ENDCOMPUTE
        </p>
    </div>
</div>
